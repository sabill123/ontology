# Ontoloty v1.0 시스템 아키텍처

```
     ██████╗ ███╗   ██╗████████╗ ██████╗ ██╗      ██████╗ ████████╗██╗   ██╗
    ██╔═══██╗████╗  ██║╚══██╔══╝██╔═══██╗██║     ██╔═══██╗╚══██╔══╝╚██╗ ██╔╝
    ██║   ██║██╔██╗ ██║   ██║   ██║   ██║██║     ██║   ██║   ██║    ╚████╔╝
    ██║   ██║██║╚██╗██║   ██║   ██║   ██║██║     ██║   ██║   ██║     ╚██╔╝
    ╚██████╔╝██║ ╚████║   ██║   ╚██████╔╝███████╗╚██████╔╝   ██║      ██║
     ╚═════╝ ╚═╝  ╚═══╝   ╚═╝    ╚═════╝ ╚══════╝ ╚═════╝    ╚═╝      ╚═╝

         Autonomous Ontology Discovery & Data Intelligence Platform
```

> **Version**: v23.0
> **Last Updated**: 2026-02-09

---

## Executive Summary

**Ontoloty**는 엔터프라이즈 데이터 사일로에서 **자율적으로 온톨로지를 발견**하고, **관계를 추론**하며, **비즈니스 인사이트**를 생성하는 AI 기반 플랫폼입니다.

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                         ONTOLOTY CORE CAPABILITIES                          ┃
┣━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃  DISCOVERY          ┃  INTELLIGENCE       ┃  GOVERNANCE                      ┃
┣━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃  • FK Detection     ┃  • OWL2 Reasoning   ┃  • BFT Consensus                 ┃
┃  • Composite FK     ┃  • SHACL Validation ┃  • Evidence Chain                ┃
┃  • Hierarchy        ┃  • TDA Analysis     ┃  • Impact Analysis               ┃
┃  • Temporal FK      ┃  • Cross-Entity     ┃  • Policy Generation             ┃
┃  • Entity Mapping   ┃  • Business Insight ┃  • Actions Engine                ┃
┗━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

---

## 1. High-Level Architecture

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                              DATA SOURCES                                     ║
║  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       ║
║  │   CSV    │  │   JSON   │  │ Parquet  │  │  Excel   │  │ Database │       ║
║  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       ║
╚═══════╪═════════════╪═════════════╪═════════════╪═════════════╪══════════════╝
        │             │             │             │             │
        └─────────────┴─────────────┼─────────────┴─────────────┘
                                    ▼
╔══════════════════════════════════════════════════════════════════════════════╗
║                           ONTOLOTY PLATFORM                                   ║
║  ┌────────────────────────────────────────────────────────────────────────┐  ║
║  │                     AUTONOMOUS PIPELINE ORCHESTRATOR                    │  ║
║  │  ╭─────────────────╮  ╭─────────────────╮  ╭─────────────────╮         │  ║
║  │  │   PHASE 1       │  │   PHASE 2       │  │   PHASE 3       │         │  ║
║  │  │   DISCOVERY     │─▶│   REFINEMENT    │─▶│   GOVERNANCE    │         │  ║
║  │  │   (6 Agents)    │  │   (4 Agents)    │  │   (4 Agents)    │         │  ║
║  │  ╰─────────────────╯  ╰─────────────────╯  ╰─────────────────╯         │  ║
║  │           │                   │                    │                    │  ║
║  │           ▼                   ▼                    ▼                    │  ║
║  │  ┌─────────────────────────────────────────────────────────────────┐   │  ║
║  │  │              AGENT COMMUNICATION BUS                             │   │  ║
║  │  │   [Direct] ─── [Broadcast] ─── [Pub/Sub] ─── [Request/Response] │   │  ║
║  │  └─────────────────────────────────────────────────────────────────┘   │  ║
║  └────────────────────────────────────────────────────────────────────────┘  ║
║                                    │                                          ║
║                                    ▼                                          ║
║  ┌────────────────────────────────────────────────────────────────────────┐  ║
║  │                          SHARED CONTEXT                                 │  ║
║  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │  ║
║  │  │ Tables  │ │Entities │ │ Ontology│ │Insights │ │Evidence │          │  ║
║  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘          │  ║
║  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │  ║
║  │  │  OWL2   │ │  SHACL  │ │ Lineage │ │Knowledge│ │Decisions│          │  ║
║  │  │(dynamic)│ │(dynamic)│ │  Graph  │ │  Graph  │ │         │          │  ║
║  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘          │  ║
║  └────────────────────────────────────────────────────────────────────────┘  ║
║                                    │                                          ║
║                                    ▼                                          ║
║  ┌────────────────────────────────────────────────────────────────────────┐  ║
║  │                       ENTERPRISE SERVICES                               │  ║
║  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │  ║
║  │  │ Actions  │ │   CDC    │ │ Lineage  │ │  Agent   │ │ Version  │     │  ║
║  │  │ Engine   │ │  Sync    │ │ Tracker  │ │ Learning │ │ Manager  │     │  ║
║  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │  ║
║  └────────────────────────────────────────────────────────────────────────┘  ║
╚══════════════════════════════════════════════════════════════════════════════╝
                                    │
                                    ▼
╔══════════════════════════════════════════════════════════════════════════════╗
║                              OUTPUT ARTIFACTS                                 ║
║  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       ║
║  │ Ontology │  │ Insights │  │ Evidence │  │ Lineage  │  │ Policies │       ║
║  │   .json  │  │   .json  │  │   .json  │  │   .json  │  │   .json  │       ║
║  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘       ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## 2. Three-Phase Pipeline Architecture

### 2.1 Phase Overview

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                          THREE-PHASE PIPELINE                                  │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│    ╔═══════════════════╗    ╔═══════════════════╗    ╔═══════════════════╗   │
│    ║    PHASE 1        ║    ║    PHASE 2        ║    ║    PHASE 3        ║   │
│    ║    DISCOVERY      ║───▶║    REFINEMENT     ║───▶║    GOVERNANCE     ║   │
│    ╚═══════════════════╝    ╚═══════════════════╝    ╚═══════════════════╝   │
│                                                                                │
│    ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐     │
│    │ 6 Agents        │      │ 4 Agents        │      │ 4 Agents        │     │
│    ├─────────────────┤      ├─────────────────┤      ├─────────────────┤     │
│    │ • Data Analyst  │      │ • Ontology      │      │ • Governance    │     │
│    │ • TDA Expert    │      │   Architect     │      │   Strategist    │     │
│    │ • Schema        │      │ • Conflict      │      │ • Action        │     │
│    │   Analyst       │      │   Resolver      │      │   Prioritizer   │     │
│    │ • Value Matcher │      │ • Quality Judge │      │ • Risk Assessor │     │
│    │ • Entity        │      │ • Semantic      │      │ • Policy        │     │
│    │   Classifier    │      │   Validator     │      │   Generator     │     │
│    │ • Relationship  │      │                 │      │                 │     │
│    │   Detector      │      │                 │      │                 │     │
│    └─────────────────┘      └─────────────────┘      └─────────────────┘     │
│                                                                                │
│    ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐     │
│    │ OUTPUTS         │      │ OUTPUTS         │      │ OUTPUTS         │     │
│    ├─────────────────┤      ├─────────────────┤      ├─────────────────┤     │
│    │ • FK Candidates │      │ • Ontology      │      │ • Decisions     │     │
│    │ • Entities      │      │ • Inferred      │      │ • Actions       │     │
│    │ • TDA Signatures│      │   Triples +     │      │ • Policies      │     │
│    │ • Homeomorphisms│      │   OWL2 Axioms   │      │ • Lineage       │     │
│    │                 │      │   (dynamic_data)│      │                 │     │
│    │                 │      │ • SHACL Results │      │                 │     │
│    │                 │      │   (dynamic_data)│      │                 │     │
│    │                 │      │ • Insights      │      │                 │     │
│    └─────────────────┘      └─────────────────┘      └─────────────────┘     │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Agent Interaction Flow

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                           AGENT INTERACTION FLOW                               │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   PHASE 1: DISCOVERY                                                           │
│   ═══════════════════                                                          │
│                                                                                │
│               ┌─────────────┐    Parallel    ┌─────────────┐                   │
│               │    TDA      │◀──Execution──▶│   Schema    │                   │
│               │   Expert    │                │   Analyst   │                   │
│               └──────┬──────┘                └──────┬──────┘                   │
│                      │                              │                           │
│                      └──────────┬───────────────────┘                           │
│                                 ▼                                               │
│                          ┌─────────────┐                                        │
│                          │   Value     │                                        │
│                          │   Matcher   │                                        │
│                          └──────┬──────┘                                        │
│                      │                             │                           │
│                      ▼                             ▼                           │
│               ┌─────────────┐               ┌─────────────┐                   │
│               │   Entity    │───Results───▶│Relationship │                   │
│               │ Classifier  │              │  Detector   │                   │
│               └─────────────┘               └──────┬──────┘                   │
│                                                    │                           │
│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│                                                    ▼                           │
│   PHASE 2: REFINEMENT                                                          │
│   ═══════════════════                                                          │
│                                                                                │
│               ┌─────────────┐                                                  │
│               │  Ontology   │◀────────────────────────┐                       │
│               │  Architect  │                         │                       │
│               └──────┬──────┘                         │                       │
│                      │                                │                       │
│          ┌───────────┼───────────┐                   │                       │
│          ▼           ▼           ▼                   │                       │
│   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │                       │
│   │  Conflict   │ │  Quality    │ │  Semantic   │───┘                       │
│   │  Resolver   │ │   Judge     │ │  Validator  │ OWL2/SHACL                │
│   └──────┬──────┘ └──────┬──────┘ └──────┬──────┘                           │
│          │               │               │                                    │
│          └───────────────┴───────────────┘                                    │
│                          │                                                     │
│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│                          ▼                                                     │
│   PHASE 3: GOVERNANCE                                                          │
│   ═══════════════════                                                          │
│                                                                                │
│          ┌─────────────────────────────────────────────────┐                  │
│          │              AGENT COUNCIL                       │                  │
│          │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐│                  │
│          │  │Ontology │ │  Risk   │ │Business │ │  Data   ││                  │
│          │  │ Expert  │ │Assessor │ │Strategy │ │ Steward ││                  │
│          │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘│                  │
│          │       └───────────┴───────────┴───────────┘     │                  │
│          │                       │                          │                  │
│          │              ┌────────▼────────┐                │                  │
│          │              │    CONSENSUS    │                │                  │
│          │              │   BFT + D-S     │                │                  │
│          │              └────────┬────────┘                │                  │
│          └───────────────────────┼─────────────────────────┘                  │
│                                  ▼                                             │
│                         [Final Decisions]                                      │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Integrated FK Detection Pipeline

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                    INTEGRATED FK DETECTION PIPELINE                            │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│    INPUT: Raw Tables                                                           │
│           ▼                                                                    │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  LAYER 1: SINGLE FK DETECTION                                          ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║                                                                        ║   │
│   ║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐   ║   │
│   ║   │  SIGNAL SCORER   │  │    DIRECTION     │  │    SEMANTIC      │   ║   │
│   ║   │                  │  │    ANALYZER      │  │    RESOLVER      │   ║   │
│   ║   ├──────────────────┤  ├──────────────────┤  ├──────────────────┤   ║   │
│   ║   │ Value Overlap    │  │ Uniqueness       │  │ Synonym Groups   │   ║   │
│   ║   │ Cardinality      │  │ Containment      │  │ Abbreviations    │   ║   │
│   ║   │ Ref. Integrity   │  │ Row Count        │  │ Entity Matching  │   ║   │
│   ║   │ Naming           │  │ Column Naming    │  │ Relation Types   │   ║   │
│   ║   │ Structure        │  │ Entity Reference │  │                  │   ║   │
│   ║   └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘   ║   │
│   ║            │                     │                     │              ║   │
│   ║            └─────────────────────┼─────────────────────┘              ║   │
│   ║                                  ▼                                    ║   │
│   ║                     Single FK Candidates                              ║   │
│   ╚══════════════════════════════════╪════════════════════════════════════╝   │
│                                      ▼                                         │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  LAYER 2: COMPOSITE FK DETECTION                                       ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║   • Multi-column combination (2-4 columns)                             ║   │
│   ║   • Joint uniqueness check (ratio > 0.8)                               ║   │
│   ║   • Cross-table referential integrity                                  ║   │
│   ╚══════════════════════════════════╪════════════════════════════════════╝   │
│                                      ▼                                         │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  LAYER 3: HIERARCHY DETECTION                                          ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║   • Self-reference pattern (manager_id → emp_id)                       ║   │
│   ║   • Value containment analysis (child ⊆ parent)                        ║   │
│   ║   • Tree structure validation (root, depth, cycle)                     ║   │
│   ╚══════════════════════════════════╪════════════════════════════════════╝   │
│                                      ▼                                         │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  LAYER 4: TEMPORAL FK DETECTION                                        ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║   • Temporal column identification (valid_from, valid_to)              ║   │
│   ║   • SCD Type classification (Type 1/2/3, Bitemporal)                   ║   │
│   ║   • History table ↔ Main table linking                                 ║   │
│   ╚══════════════════════════════════╪════════════════════════════════════╝   │
│                                      ▼                                         │
│    OUTPUT: Integrated FK Results                                               │
│            • enhanced_fk_candidates                                            │
│            • composite_fk_candidates                                           │
│            • hierarchy_candidates                                              │
│            • temporal_fk_candidates                                            │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Agent Communication Bus

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                       AGENT COMMUNICATION BUS                                  │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   ┌────────────────────────────────────────────────────────────────────────┐  │
│   │                         MESSAGE BUS                                     │  │
│   ├────────────────────────────────────────────────────────────────────────┤  │
│   │                                                                         │  │
│   │   PATTERN 1: DIRECT MESSAGING (1:1)                                     │  │
│   │   ════════════════════════════════                                      │  │
│   │                                                                         │  │
│   │      ┌─────────┐  ─────────────▶  ┌─────────┐                          │  │
│   │      │ Agent A │     Message      │ Agent B │                          │  │
│   │      └─────────┘  ◀─────────────  └─────────┘                          │  │
│   │                                                                         │  │
│   │   PATTERN 2: BROADCAST (1:N)                                            │  │
│   │   ═══════════════════════════                                           │  │
│   │                                                                         │  │
│   │                    ┌─────────┐                                          │  │
│   │                ┌──▶│ Agent B │                                          │  │
│   │   ┌─────────┐  │   └─────────┘                                          │  │
│   │   │ Agent A │──┼──▶┌─────────┐                                          │  │
│   │   └─────────┘  │   │ Agent C │                                          │  │
│   │                │   └─────────┘                                          │  │
│   │                └──▶┌─────────┐                                          │  │
│   │                    │ Agent D │                                          │  │
│   │                    └─────────┘                                          │  │
│   │                                                                         │  │
│   │   PATTERN 3: PUB/SUB (Topic-based)                                      │  │
│   │   ════════════════════════════════                                      │  │
│   │                                                                         │  │
│   │   ┌─────────┐         ┌──────────────────┐         ┌─────────┐         │  │
│   │   │Publisher│──pub──▶│ Topic: fk.detect │──sub──▶│Subscriber│         │  │
│   │   └─────────┘         └──────────────────┘         └─────────┘         │  │
│   │                                                                         │  │
│   │   PATTERN 4: REQUEST/RESPONSE (RPC-style)                               │  │
│   │   ═══════════════════════════════════════                               │  │
│   │                                                                         │  │
│   │      ┌─────────┐  ──Request──▶  ┌─────────┐                            │  │
│   │      │ Caller  │                │ Handler │                            │  │
│   │      └─────────┘  ◀─Response──  └─────────┘                            │  │
│   │                                                                         │  │
│   └────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│   MESSAGE TYPES                                                                │
│   ═════════════                                                                │
│                                                                                │
│   ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐    │
│   │    INFO     │  DISCOVERY  │    ALERT    │   REQUEST   │  RESPONSE   │    │
│   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤    │
│   │COLLABORATION│ VALIDATION  │  FEEDBACK   │  HEARTBEAT  │   STATUS    │    │
│   └─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘    │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. SharedContext Data Model

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                         SHARED CONTEXT DATA MODEL                              │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   SharedContext                                                                │
│   ═════════════                                                                │
│                                                                                │
│   ┌──────────────────────────────────────────────────────────────────────┐   │
│   │  CORE DATA                                                            │   │
│   ├──────────────────────────────────────────────────────────────────────┤   │
│   │  tables: Dict[str, TableInfo]          # Table metadata + DataFrame  │   │
│   │  unified_entities: List[UnifiedEntity] # Cross-table entities        │   │
│   │  domain_context: DomainContext         # Auto-detected domain        │   │
│   └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                │
│   ┌──────────────────────────────────────────────────────────────────────┐   │
│   │  FK DETECTION RESULTS                                                 │   │
│   ├──────────────────────────────────────────────────────────────────────┤   │
│   │  enhanced_fk_candidates: List[Dict]    # Single FK candidates        │   │
│   │  composite_fk_candidates: List[Dict]   # Multi-column FK             │   │
│   │  hierarchy_candidates: List[Dict]      # Self-reference hierarchies  │   │
│   │  temporal_fk_candidates: List[Dict]    # SCD Type 2 relationships    │   │
│   └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                │
│   ┌──────────────────────────────────────────────────────────────────────┐   │
│   │  ONTOLOGY                                                             │   │
│   ├──────────────────────────────────────────────────────────────────────┤   │
│   │  ontology_concepts: List[OntologyConcept]                            │   │
│   │  concept_relationships: List[ConceptRelationship]                    │   │
│   │  knowledge_graph_triples: List[Dict]  # RDF-style triples           │   │
│   │  semantic_base_triples: List[Dict]   # Base semantic triples       │   │
│   │  inferred_triples: List[Dict]        # Inferred relationships      │   │
│   │  governance_triples: List[Dict]      # Governance triples          │   │
│   └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                │
│   ┌──────────────────────────────────────────────────────────────────────┐   │
│   │  DYNAMIC DATA                                                         │   │
│   ├──────────────────────────────────────────────────────────────────────┤   │
│   │  dynamic_data: Dict[str, Any]           # OWL2/SHACL 결과 포함       │   │
│   │    ├── owl2_axioms: List[Dict]          # OWL2 Reasoner 결과         │   │
│   │    ├── shacl_violations: List[Dict]     # SHACL 위반 목록            │   │
│   │    ├── shacl_shapes: List[Dict]         # SHACL Shape 정의           │   │
│   │    ├── column_semantics, data_patterns, business_roles, ...          │   │
│   └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                │
│   ┌──────────────────────────────────────────────────────────────────────┐   │
│   │  GOVERNANCE                                                           │   │
│   ├──────────────────────────────────────────────────────────────────────┤   │
│   │  governance_decisions: List[GovernanceDecision]                      │   │
│   │  business_insights: List[BusinessInsight]                            │   │
│   │  evidence_chain: List[EvidenceBlock]   # Blockchain-style audit      │   │
│   │  lineage_graph: Dict                   # Column-level lineage        │   │
│   └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Evidence Chain (Audit Trail)

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                      EVIDENCE CHAIN (BLOCKCHAIN-STYLE)                         │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐          │
│   │   BLOCK #0      │───▶│   BLOCK #1      │───▶│   BLOCK #2      │─ ─ ▶    │
│   │   (Genesis)     │    │                 │    │                 │          │
│   ├─────────────────┤    ├─────────────────┤    ├─────────────────┤          │
│   │ block_id        │    │ block_id        │    │ block_id        │          │
│   │ previous_hash:0 │    │ previous_hash   │    │ previous_hash   │          │
│   │ agent_id        │    │ agent_id        │    │ agent_id        │          │
│   │ phase           │    │ phase           │    │ phase           │          │
│   │ evidence_type   │    │ evidence_type   │    │ evidence_type   │          │
│   │ content         │    │ content         │    │ content         │          │
│   │ timestamp       │    │ timestamp       │    │ timestamp       │          │
│   │ hash            │───▶│ hash            │───▶│ hash            │          │
│   └─────────────────┘    └─────────────────┘    └─────────────────┘          │
│                                                                                │
│   EVIDENCE TYPES                                                               │
│   ══════════════                                                               │
│                                                                                │
│   ┌─────────────────────────────────────────────────────────────────────────┐│
│   │ Phase 1: tda_analysis, schema_analysis, value_matching,                 ││
│   │          entity_classification, relationship_detection                  ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │ Phase 2: ontology_design, conflict_resolution, quality_assessment,      ││
│   │          semantic_validation                                            ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │ Phase 3: governance_decision, risk_assessment, action_creation,         ││
│   │          policy_generation                                              ││
│   └─────────────────────────────────────────────────────────────────────────┘│
│                                                                                │
│   INTEGRITY VERIFICATION                                                       │
│   ══════════════════════                                                       │
│                                                                                │
│   verify_chain():                                                              │
│       for each block in chain:                                                 │
│           computed_hash = SHA256(block.content + block.previous_hash)         │
│           assert computed_hash == block.hash                                   │
│           assert block.previous_hash == chain[i-1].hash                       │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Consensus Engine

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                          CONSENSUS ENGINE                                      │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  BYZANTINE FAULT TOLERANT (BFT) VOTING                                 ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║                                                                        ║   │
│   ║   Requirement: n ≥ 3f + 1  (n = total, f = faulty)                    ║   │
│   ║                                                                        ║   │
│   ║   ROUND 1: Initial Vote                                                ║   │
│   ║   ─────────────────────                                                ║   │
│   ║   • Each agent votes: APPROVE / REJECT / REVIEW                       ║   │
│   ║   • If unanimous or >75% agree → Fast-track                           ║   │
│   ║                                                                        ║   │
│   ║   ROUND 2: Deep Debate (on conflict)                                   ║   │
│   ║   ──────────────────────────────────                                   ║   │
│   ║   • Minority opinion agent presents CHALLENGE                          ║   │
│   ║   • Algorithmic evidence provided                                      ║   │
│   ║   • Re-vote with new information                                       ║   │
│   ║                                                                        ║   │
│   ║   ROUND 3+: Forced Decision                                            ║   │
│   ║   ─────────────────────────                                            ║   │
│   ║   • Max rounds reached → Soft Consensus                               ║   │
│   ║   • Confidence score adjusted downward                                 ║   │
│   ║                                                                        ║   │
│   ╚═══════════════════════════════════════════════════════════════════════╝   │
│                                                                                │
│   ╔═══════════════════════════════════════════════════════════════════════╗   │
│   ║  DEMPSTER-SHAFER FUSION                                                ║   │
│   ╠═══════════════════════════════════════════════════════════════════════╣   │
│   ║                                                                        ║   │
│   ║   (m₁ ⊕ m₂)(A) = (1/(1-K)) × Σ m₁(B) × m₂(C)                          ║   │
│   ║                               B∩C=A                                    ║   │
│   ║                                                                        ║   │
│   ║   K = Σ m₁(B) × m₂(C)   where B ∩ C = ∅                              ║   │
│   ║                                                                        ║   │
│   ║   • K → 0 : Evidence is consistent (high confidence)                  ║   │
│   ║   • K → 1 : Evidence conflicts (judgment suspended)                   ║   │
│   ║                                                                        ║   │
│   ╚═══════════════════════════════════════════════════════════════════════╝   │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Enterprise Services

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                          ENTERPRISE SERVICES                                   │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   ┌─────────────────────────────────────────────────────────────────────────┐│
│   │  ACTIONS ENGINE                                                          ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │                                                                          ││
│   │  TRIGGERS                          ACTIONS                               ││
│   │  ════════                          ═══════                               ││
│   │  • ENTITY_CREATED                  • NOTIFICATION                        ││
│   │  • ENTITY_UPDATED                  • WEBHOOK                             ││
│   │  • ENTITY_DELETED                  • FUNCTION                            ││
│   │  • RELATIONSHIP_CREATED            • WORKFLOW                            ││
│   │  • CONCEPT_APPROVED                • DATA_QUALITY_CHECK                  ││
│   │  • QUALITY_THRESHOLD               • SYNC_EXTERNAL                       ││
│   │  • SCHEDULE                                                              ││
│   │                                                                          ││
│   │  STATUS: PENDING → SCHEDULED → IN_PROGRESS → COMPLETED/FAILED           ││
│   └─────────────────────────────────────────────────────────────────────────┘│
│                                                                                │
│   ┌─────────────────────────────────────────────────────────────────────────┐│
│   │  CDC SYNC ENGINE                                                         ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │                                                                          ││
│   │  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐             ││
│   │  │  INSERT  │   │  UPDATE  │   │  DELETE  │   │  SCHEMA  │             ││
│   │  │  Event   │   │  Event   │   │  Event   │   │  CHANGE  │             ││
│   │  └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘             ││
│   │       └──────────────┴──────────────┴──────────────┘                    ││
│   │                              │                                           ││
│   │                              ▼                                           ││
│   │                    ┌──────────────────┐                                 ││
│   │                    │  Change Handler  │──▶ Lineage Update              ││
│   │                    └──────────────────┘──▶ Ontology Refresh            ││
│   │                                                                          ││
│   └─────────────────────────────────────────────────────────────────────────┘│
│                                                                                │
│   ┌─────────────────────────────────────────────────────────────────────────┐│
│   │  COLUMN-LEVEL LINEAGE                                                    ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │                                                                          ││
│   │      SOURCE                TRANSFORM               DERIVED              ││
│   │   ┌──────────┐           ┌──────────┐           ┌──────────┐           ││
│   │   │orders.   │──COPY───▶│ staging. │──AGG────▶│ report.  │           ││
│   │   │customer  │           │ cust_id  │           │ cust_cnt │           ││
│   │   └──────────┘           └──────────┘           └──────────┘           ││
│   │        │                                                                 ││
│   │        └─────────────FK_REF─────────▶ ┌──────────┐                     ││
│   │                                        │customers.│                     ││
│   │                                        │    id    │                     ││
│   │                                        └──────────┘                     ││
│   │                                                                          ││
│   │  IMPACT ANALYSIS: What happens if customers.id changes?                 ││
│   │  → orders.customer, staging.cust_id, report.cust_cnt affected           ││
│   │                                                                          ││
│   └─────────────────────────────────────────────────────────────────────────┘│
│                                                                                │
│   ┌─────────────────────────────────────────────────────────────────────────┐│
│   │  AGENT LEARNING SYSTEM                                                   ││
│   ├─────────────────────────────────────────────────────────────────────────┤│
│   │                                                                          ││
│   │  Experience Replay Memory                                                ││
│   │  ════════════════════════                                                ││
│   │                                                                          ││
│   │  ┌─────────────────────────────────────────────────────────────────┐   ││
│   │  │ experience_type    │ context          │ action   │ outcome     │   ││
│   │  ├─────────────────────────────────────────────────────────────────┤   ││
│   │  │ FK_DETECTION       │ buyer_id→cust_id │ confirm  │ SUCCESS     │   ││
│   │  │ ENTITY_MAPPING     │ Client=Customer  │ merge    │ SUCCESS     │   ││
│   │  │ CONFLICT_RESOLVE   │ Name collision   │ rename   │ PARTIAL     │   ││
│   │  └─────────────────────────────────────────────────────────────────┘   ││
│   │                                                                          ││
│   │  recall(similar_context) → suggested_action                             ││
│   │  learn_from_feedback(outcome) → update_weights                          ││
│   │                                                                          ││
│   └─────────────────────────────────────────────────────────────────────────┘│
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Directory Structure

```
src/unified_pipeline/
├── unified_main.py                    # Main entry point
├── autonomous_pipeline.py             # Pipeline orchestrator
├── shared_context.py                  # Central memory system
├── model_config.py                    # LLM configuration
├── contracts.py                       # Phase contract validation (v6.0)
│
├── autonomous/
│   ├── orchestrator.py                # Agent orchestrator
│   ├── base.py                        # AutonomousAgent base class (78KB)
│   ├── agent_bus.py                   # Communication bus (v16.0)
│   ├── evidence_chain.py              # Blockchain-style audit trail
│   ├── debate_protocol.py             # BFT debate with CouncilAgent
│   │
│   ├── agents/
│   │   ├── discovery.py               # 6 Discovery agents
│   │   ├── refinement.py              # 4 Refinement agents
│   │   └── governance.py              # 4 Governance agents
│   │
│   ├── analysis/                      # 49 analysis modules
│   │   ├── # ── FK Detection ──
│   │   ├── integrated_fk_detector.py  # Unified 5-stage FK pipeline
│   │   ├── composite_fk_detector.py   # Multi-column FK
│   │   ├── hierarchy_detector.py      # Self-reference hierarchies
│   │   ├── temporal_fk_detector.py    # SCD Type 2 detection
│   │   ├── fk_signal_scorer.py        # 5-signal FK scoring
│   │   ├── fk_direction_analyzer.py   # Probabilistic direction
│   │   ├── semantic_fk_detector.py    # Semantic FK detection
│   │   ├── semantic_entity_resolver.py # Entity name resolution
│   │   ├── enhanced_fk_detector.py    # Advanced FK detection
│   │   ├── enhanced_fk_pipeline.py    # FK pipeline orchestration
│   │   ├── universal_fk_detector.py   # Domain-agnostic FK (v6.0)
│   │   ├── llm_fk_validator.py        # LLM-based FK validation
│   │   ├── llm_fk_verifier.py         # LLM FK verification
│   │   ├── # ── Semantic/Ontology ──
│   │   ├── owl2_reasoner.py           # OWL 2 reasoning (5 axiom types)
│   │   ├── shacl_validator.py         # SHACL validation (6 constraints)
│   │   ├── knowledge_graph.py         # RDF triple construction
│   │   ├── ontology.py                # Conflict/Quality/Semantic analysis
│   │   ├── ontology_alignment.py      # Cross-domain alignment
│   │   ├── semantic_reasoner.py       # RDFS/OWL reasoning engine
│   │   ├── graph.py                   # Graph analysis
│   │   ├── graph_embedding.py         # Node2Vec + community detection
│   │   ├── # ── Statistical/Causal ──
│   │   ├── tda.py                     # Topological data analysis
│   │   ├── advanced_tda.py            # Ripser-based persistent homology
│   │   ├── cross_entity_correlation.py # Multi-table correlation
│   │   ├── causal_impact.py           # Causal inference (125KB)
│   │   ├── anomaly_detection.py       # Ensemble outlier detection
│   │   ├── enhanced_validator.py      # Dempster-Shafer + stat tests
│   │   ├── # ── Business/Insights ──
│   │   ├── business_insights.py       # LLM-based business insights
│   │   ├── unified_insight_pipeline.py # Algorithm→Simulation→LLM
│   │   ├── kpi_predictor.py           # Time series + ROI prediction
│   │   ├── simulation_engine.py       # Scenario simulation
│   │   ├── time_series_forecaster.py  # Temporal prediction
│   │   ├── # ── Entity/Schema ──
│   │   ├── entity_extractor.py        # Hidden entity extraction
│   │   ├── entity_resolution.py       # ML-based entity matching
│   │   ├── schema.py                  # Schema profiling
│   │   ├── similarity.py              # Jaccard/Containment
│   │   ├── advanced_similarity.py     # MinHash/LSH/HyperLogLog
│   │   ├── # ── Utility ──
│   │   ├── column_normalizer.py       # Column normalization
│   │   ├── data_quality_analyzer.py   # Data quality assessment
│   │   ├── governance.py              # Governance analysis
│   │   ├── insight_standardizer.py    # Insight format normalization
│   │   ├── llm_schema_analyzer.py     # LLM schema analysis
│   │   ├── llm_semantic_enhancer.py   # LLM semantic enrichment
│   │   ├── process_analyzer.py        # Business process analysis
│   │   ├── structured_debate.py       # Structured debate framework
│   │   ├── value_pattern_analyzer.py  # Value pattern detection
│   │   ├── virtual_entity_generator.py # Domain-specific virtual entities
│   │   └── utils.py                   # JSON parsing, retry utilities
│   │
│   ├── consensus/
│   │   ├── engine.py                  # BFT + DS consensus (85KB)
│   │   └── models.py                  # Consensus data models
│   │
│   └── learning/
│       └── agent_memory.py            # Experience replay (v16.0)
│
├── actions/
│   └── engine.py                      # Trigger-based actions
│
├── sync/
│   └── cdc_engine.py                  # Change data capture
│
├── lineage/
│   └── column_lineage.py              # Impact analysis
│
├── versioning/
│   └── version_manager.py             # Git-style versioning
│
├── domain/                            # Domain auto-detection
├── todo/                              # Agent task management
├── calibration/                       # Confidence calibration (3-part)
├── writeback/                         # Data writeback
├── remediation/                       # Error recovery
├── explanation/                       # Decision explainability
├── what_if/                           # What-if scenario analysis
├── reporting/                         # Report generation
├── semantic_search/                   # Natural language search
├── osdk/                              # OSDK integration
├── branching/                         # Branch/merge management
├── streaming/                         # Event bus & streaming engine
├── validation/                        # Cross-dataset validation
├── measurement/                       # Outcome measurement
├── dspy_modules/                      # DSPy prompt optimization
├── oql/                               # Ontology Query Language
├── workflow/                          # Workflow orchestration
├── definitions/                       # Schema definitions
├── infrastructure/                    # Infrastructure utilities
└── enterprise/                        # Audit logging
```

---

## 10. Supported Domains

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                          SUPPORTED DOMAINS                                     │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│   │ HEALTHCARE  │  │  ECOMMERCE  │  │  MARKETING  │  │     HR      │         │
│   ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤         │
│   │ 10 tables   │  │ 11 tables   │  │ 11 tables   │  │ 11 tables   │         │
│   │ patients    │  │ customers   │  │ campaigns   │  │ employees   │         │
│   │ diagnoses   │  │ orders      │  │ channels    │  │ departments │         │
│   │ claims      │  │ products    │  │ conversions │  │ salaries    │         │
│   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                                                │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│   │   AIRPORT   │  │   FINANCE   │  │  EDUCATION  │  │  LOGISTICS  │         │
│   ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤         │
│   │ 9 tables    │  │ 10 tables   │  │ 10 tables   │  │ 10 tables   │         │
│   │ flights     │  │ accounts    │  │ students    │  │ shipments   │         │
│   │ passengers  │  │ transactions│  │ courses     │  │ warehouses  │         │
│   │ terminals   │  │ loans       │  │ enrollments │  │ carriers    │         │
│   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                                                │
│   ┌─────────────┐  ┌─────────────┐                                             │
│   │MANUFACTURING│  │   MEDIA/    │   Domain Auto-Detection: 92-100%            │
│   ├─────────────┤  │ENTERTAINMENT│   Pattern Matching: Table names, Columns    │
│   │ 10 tables   │  ├─────────────┤                                             │
│   │ plants      │  │ videos      │                                             │
│   │ work_orders │  │ channels    │                                             │
│   │ equipment   │  │ creators    │                                             │
│   └─────────────┘  └─────────────┘                                             │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 11. Quick Start

```bash
# Install dependencies
pip install -r requirements.txt

# Run pipeline on a data folder
python -m src.unified_pipeline.unified_main ./data/healthcare_silo/

# Output location
output/healthcare_silo_test_YYYYMMDD_HHMMSS/
├── shared_context.json
├── evidence_chain.json
├── summary.json
└── all_events.json
```

---

## 12. Configuration

```python
# Environment Variables
LLM_GATEWAY_URL=https://gateway.letsur.ai/v1   # LLM Gateway
LLM_GATEWAY_API_KEY=...                          # Gateway API Key

# Pipeline Configuration
PipelineConfig:
    phases: ["discovery", "refinement", "governance"]
    max_concurrent_agents: 10
    enable_continuation: True
    auto_detect_domain: True
    enable_agent_bus: True
    enable_agent_learning: True
    enable_v17_services: True
    llm_model: "auto"  # Gateway routes to optimal model
```

---

## Related Documentation

| Document | Description |
|----------|-------------|
| [PHASE_1_DISCOVERY_SPEC.md](./PHASE_1_DISCOVERY_SPEC.md) | Discovery phase details |
| [PHASE_2_REFINEMENT_SPEC.md](./PHASE_2_REFINEMENT_SPEC.md) | Refinement phase details |
| [PHASE_3_GOVERNANCE_SPEC.md](./PHASE_3_GOVERNANCE_SPEC.md) | Governance phase details |
| [ALGORITHMS_AND_MATHEMATICS.md](./ALGORITHMS_AND_MATHEMATICS.md) | Mathematical foundations |
| [USER_GUIDE.md](./USER_GUIDE.md) | User manual |

---

## 13. v17 Enterprise Services Framework

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                    v17 ENTERPRISE SERVICES FRAMEWORK                          │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│   PRE-PIPELINE HOOKS                     POST-PIPELINE HOOKS                  │
│   ════════════════════                   ═══════════════════                  │
│   • VersionManager.commit()              • DecisionExplainer.explain()        │
│   • OSDKClient.sync()                    • ReportGenerator.generate()         │
│   • SemanticSearcher.index()             • WhatIfAnalyzer.analyze()           │
│   • RemediationEngine.check()            • VersionManager.tag()              │
│                                                                                │
│   POST-PHASE HOOKS                                                            │
│   ══════════════════                                                          │
│   • VersionManager.commit_phase()                                             │
│   • ConfidenceCalibrator.update()                                             │
│                                                                                │
│   ACTIVATION: enable_v17_services=True (autonomous_pipeline.py)               │
│   SAFETY: Each service wrapped in try/except, individual failure ≠ crash      │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

*Document Version: v23.0 | Last Updated: 2026-02-09*
